<table style="width:100%">
  <tr class="contain-align-left">
    <th>
      collection
    </th><th>
      specimen
    </th><th>
      project
    </th><th>
      data size
    </th><th>
      notified at
    </th>
  </tr>

  <% @objects.each do |collection| %>

  <% file_info_md = collection.metadata :data_origin, :upload_notified_at %>

  <% collection.metadata(:data_origin, :derived_from, 'orvos#specimen').collect(&:head).select { |s| s.is_a? Specimen }.each do |specimen| %>

  <% specimen_ext_ids = specimen.metadata(:identifier, :external_id).collect(&:head) %>

  <% specimen.metadata(:group, :member_of, 'orvos#project').collect(&:head).select { |p| p.is_a? Project }.each do |project| %>

  <tr class="collection-status collection-status-<%= collection.uuid %>" data-showhide-selector="tr#extra-info-<%= collection.uuid %>" style="cursor:pointer">
    <td>
      <%= collection.uuid %>
    </td><td>
      <%= specimen.uuid %>
      <% specimen_ext_ids.each do |x| %>
      <br />
      <strong><%= x %></strong>
      <% end %>
    </td><td>
      <%= project.name %>
    </td><td>
      <% file_info_md.each do |fi| %>
      <strong><%= number_to_human_size(fi.info[:file_sizes].inject(0) { |s,x| s += x.to_i }) rescue nil %></strong> (<%= fi.head %>)
      <br />
      <% end %>
    </td><td>
      <%= file_info_md.collect &:head %>
    </td>
  </tr>

  <% if file_info_md.size > 0 %>
  <tr id="extra-info-<%= collection.uuid %>" data-showhide-default>
    <td colspan="5">
      <dl>
      <% file_info_md.collect(&:info).each do |k,v| %>
      <dt><em><%= k %></em></dt>
      <dd><%= v %></dd>
      <% end %>
      </dl>
    </td>
  </tr>

  <% end %>
  <% end %>
  <% end %>
  <% end %>
</table>
