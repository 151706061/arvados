<% content_for :css do %>
.file-list-inline-image {
  width: 50%;
  height: auto; 
}
<% end %>

<table class="table table-condensed table-fixedlayout">
  <colgroup>
    <col width="4%" />
    <col width="35%" />
    <col width="40%" />
    <col width="15%" />
    <col width="10%" />
  </colgroup>
  <thead>
    <tr>
      <th></th>
      <th>path</th>
      <th>file</th>
      <th style="text-align:right">size</th>
      <th>d/l</th>
    </tr>
  </thead><tbody>
    <% if @object then @object.files.sort_by{|f|[f[0],f[1]]}.each do |file| %>
    <% file_path = "#{file[0]}/#{file[1]}" %>
    <tr>
      <td>
        <% fp2 = file_path[2..-1] if file_path[0..1] == './' %>
        <% fp2 ||= file_path %>
<%= check_box_tag 'uuids[]', @object.uuid+file_path, false, {
  :class => 'persistent-selection', 
  :friendly_type => "File",
  :friendly_name => "#{@object.uuid}/#{fp2}",
  :href => "#{url_for controller: 'collections', action: 'show', id: @object.uuid }/#{file_path}" 
      } %>
      </td>
      <td>
        <%= file[0] %>
      </td>

      <td>
        <%= link_to((if /\.(jpg|jpeg|gif|png|svg)$/i.match(file[1]) then
                       image_tag "#{url_for @object}/#{file_path}", class: "file-list-inline-image"
                     else
                       file[1]
                     end), 
                    {controller: 'collections', action: 'show_file', uuid: @object.uuid, file: file_path, size: file[2], disposition: 'inline'}, 
                    {title: file_path}) %>
      </td>

      <td style="text-align:right">
        <%= raw(human_readable_bytes_html(file[2])) %>
      </td>

      <td>
        <div style="display:inline-block">
          <%= link_to raw('<i class="glyphicon glyphicon-download-alt"></i>'), {controller: 'collections', action: 'show_file', uuid: @object.uuid, file: file_path, size: file[2], disposition: 'attachment'}, {class: 'btn btn-info btn-sm', title: 'Download'} %>
        </div>
      </td>
    </tr>
    <% end; end %>
  </tbody>
</table>
