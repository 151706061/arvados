<% content_for :css do %>
ul.collection_files {
  line-height: 2.5em;
  list-style-type: none;
  background: #FFF;
}

ul.collection_files li {
  clear: both;
}

li.collection_files_row_even {
  background: #FFF;
}

li.collection_files_row_odd {
  background: #EEE;
}

.collection_files_inline {
  clear: both;
  width: 80%;
  height: auto;
  max-height: 6em;
  margin: 0 1em;
}

.collection_files_name {
  padding-left: .5em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.collection_files_name i.fa {
  display: block-inline;
  width: 1.75em;
  text-align: center;
}

.collection_files_buttons {
  float: right;
}
<% end %>

<% content_for :tab_line_buttons do %>
<div class="row">
  <div class="col-md-6"></div>
  <div class="col-md-6">
    <div class="pull-right">
      Collection storage status:
      <%= render partial: 'toggle_persist', locals: { uuid: @object.uuid, current_state: (@is_persistent ? 'persistent' : 'cache') } %>
    </div>
  </div>
</div>
<% end %>

<% file_tree = @object.andand.files_tree %>
<% if file_tree.nil? or file_tree.empty? %>
  <p>This collection is empty.</p>
<% else %>
  <ul id="collection_files" class="collection_files">
  <% dirstack = [file_tree.first.first] %>
  <% file_tree.each_with_index do |(dirname, filename, size), index| %>
    <% file_path = CollectionsHelper::file_path([dirname, filename]) %>
    <% while dirstack.any? and (dirstack.last != dirname) %>
      <% dirstack.pop %></ul></li>
    <% end %>
    <li class="collection_files_row_<%= (index.odd?) ? 'odd' : 'even' %>">
    <% if size.nil?  # This is a subdirectory. %>
      <% dirstack.push(File.join(dirname, filename)) %>
      <div class="collection_files_name"><i class="fa fa-folder-open"></i> <%= filename %></div>
        <ul class="collection_files">
    <% else %>
      <% link_params = {controller: 'collections', action: 'show_file',
                        uuid: @object.uuid, file: file_path, size: size} %>
        <div class="collection_files_buttons">
          <%= raw(human_readable_bytes_html(size)) %>
          <%= check_box_tag 'uuids[]', "#{@object.uuid}/#{file_path}", false, {
                :class => 'persistent-selection',
                :friendly_type => "File",
                :friendly_name => "#{@object.uuid}/#{file_path}",
                :href => url_for(controller: 'collections', action: 'show_file',
                                 uuid: @object.uuid, file: file_path),
                :title => "Include #{file_path} in your selections",
              } %>
          <%= link_to(raw('<i class="fa fa-search"></i>'),
                      link_params.merge(disposition: 'inline'),
                      {title: "View #{file_path}", class: "btn btn-info btn-sm"}) %>
          <%= link_to(raw('<i class="fa fa-download"></i>'),
                      link_params.merge(disposition: 'attachment'),
                      {title: "Download #{file_path}", class: "btn btn-info btn-sm"}) %>
        </div>
      <% if CollectionsHelper::is_image(filename) %>
        <div class="collection_files_name"><i class="fa fa-bar-chart-o"></i> <%= filename %></div>
        <div class="collection_files_inline">
          <%= link_to(image_tag("#{url_for @object}/#{file_path}"),
                      link_params.merge(disposition: 'inline'),
                      {title: file_path}) %>
        </div>
      <% else %>
        <div class="collection_files_name"><i class="fa fa-file"></i> <%= filename %></div>
      <% end %>
      </li>
    <% end  # if file or directory %>
  <% end  # file_tree.each %>
  </ul>
<% end  # if file_tree %>
