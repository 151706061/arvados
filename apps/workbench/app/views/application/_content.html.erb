<% content_for :tab_panes do %>

<% comparable = controller.respond_to? :compare %>

<ul class="nav nav-tabs">
  <% pane_list.each_with_index do |pane, i| %>
    <li class="<%= 'active' if i==0 %>"><a href="#<%= pane %>" data-toggle="tab" id="<%= pane %>-tab"> <%= pane.gsub('_', ' ') %></a></li>
  <% end %>
</ul>
<div class="tab-content">
<% pane_list.each_with_index do |pane, i| %>
  <div id="<%= pane %>"
       class="tab-pane fade <%= 'in active' if i==0 %> arv-log-event-listener"
       data-object-uuid="<%= @object.uuid if @object %>">

<% content_for :js do %>
  $(document).on('<%= 'ready' if i != 0 %> arv-log-event', function() {
  $.ajax('<%= url_for @object %>?tab_pane=<%= pane %>', {dataType: 'html', type: 'GET'}).
  done(function(data, status, jqxhr) {
    $('#<%= pane %> > div > div').html(data);
  }).
  fail(function(jqxhr, status, error) {
  });
  });
<% end %>

    <div class="smart-scroll" style="margin-top:0.5em;">
      <div class="pane-content">
        <% if i == 0 %>
          <%= render(partial: 'show_' + pane.downcase,
                     locals: { comparable: comparable, objects: @objects }) %>
          <% else %>
            <%= image_tag 'ajax-loader.gif' %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
</div>

<% end %>

<% content_for :js do %>
    $(window).on('load', smart_scroll_fixup);
    $(document).on('shown.bs.tab', 'ul.nav-tabs > li > a', smart_scroll_fixup);
<% end %>
