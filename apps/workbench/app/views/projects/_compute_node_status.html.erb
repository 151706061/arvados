<h4>Queue</h4>
<% queue = queued_processes %>
<% if queue.any? %>

<% queue.each do |q| %>
  <% wu = q.work_unit %>
  <div class="row">
    <div class="col-md-3 text-overflow-ellipsis">
      <%= link_to_if_arvados_object q, friendly_name: true %>
    </div>
    <div class="col-md-4">
      <%= render_localized_date(wu.created_at) %>
    </div>
    <div class="col-md-3">
      <%= render_runtime(Time.now - wu.created_at, false) %>
    </div>
    <div class="col-md-2">
      <%= wu.priority %>
    </div>
  </div>
<% end %>
  <div class="row">
    <div class="col-md-3">
      <b>Process</b>
    </div>
    <div class="col-md-4">
      <b>Submitted</b>
    </div>
    <div class="col-md-3">
      <b>Queued</b>
    </div>
    <div class="col-md-2">
      <b>Priority</b>
    </div>
  </div>
<% else %>
  There are currently no processes in your queue.
<% end %>

<h4>Node status</h4>
<div class="compute-summary-nodelist">
    <% nodes.sort_by { |n| n.hostname || "" }.each do |n| %>
      <% if n.crunch_worker_state.in? ["busy", "idle"] and (Time.now - n[:last_ping_at]) < 3600 %>
        <div class="compute-summary">
          <a data-toggle="collapse" href="#detail_<%= n.hostname %>" class="compute-summary-head label label-<%= if n.crunch_worker_state == 'busy' then 'primary' else 'default' end %>">
            <%= n.hostname %>
          </a>
          <div id="detail_<%= n.hostname %>" class="collapse compute-detail">
            state: <%= n.crunch_worker_state %><br>
            <% [:total_cpu_cores, :total_ram_mb, :total_scratch_mb].each do |i| %>
              <%= i.to_s.gsub '_', ' ' %>: <%= n.properties[i] %><br>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
</div>
